<script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwr_vi5RnGrsvkHCEM6SQt63_ThvZ8QH_fv91731LJdFzdCBAcED6jandGo1oOl79hosA/exec';
        const studentId = localStorage.getItem('studentId') || 'Anonymous';
        
        const capPart = document.getElementById('cap-part');
        const puncPart = document.getElementById('punc-part');
        const whoPart = document.getElementById('who-part');
        const morePart = document.getElementById('more-part');
        const msgBar = document.getElementById('msg-bar');
        const rulesArea = document.getElementById('rules-area');

        let step = 1;
        capPart.classList.add('active-target');

        function logData(action, result, isCorrect) {
            const data = { 
                studentId: studentId, 
                activity: 'Sentence Structure', 
                action: action, 
                result: result,
                isCorrect: isCorrect 
            };
            fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        }

        function handleClick(clickedType) {
            // Step 1
            if (step === 1 && clickedType === 'cap') {
                capPart.classList.add('blue-box');
                capPart.classList.remove('active-target');
                logData('Step 1', 'Found Capital Letter', 'Yes'); // 記錄 Yes
                
                step = 2;
                msgBar.innerText = "Step 2: Touch the punctuation at the end.";
                msgBar.style.backgroundColor = "#e1f5fe";
                puncPart.classList.add('active-target');
            }
            // Step 2
            else if (step === 2 && clickedType === 'punc') {
                puncPart.classList.add('blue-box');
                puncPart.classList.remove('active-target');
                logData('Step 2', 'Found Punctuation', 'Yes'); // 記錄 Yes

                step = 3;
                msgBar.innerText = "Step 3: Underline the naming part (Who).";
                msgBar.style.backgroundColor = "#fff9c4";
                whoPart.classList.add('active-target');
            }
            // Step 3
            else if (step === 3 && clickedType === 'who') {
                whoPart.classList.add('black-underline');
                whoPart.classList.remove('active-target');
                logData('Step 3', 'Found Who Part', 'Yes'); // 記錄 Yes

                step = 4;
                msgBar.innerText = "Step 4: Circle the telling part (Tells more).";
                msgBar.style.backgroundColor = "#e1f5fe";
                morePart.classList.add('active-target');
            }
            // Step 4
            else if (step === 4 && clickedType === 'more') {
                morePart.classList.add('black-oval');
                morePart.classList.remove('active-target');
                logData('Step 4', 'Found Telling Part', 'Yes'); // 記錄 Yes

                step = 5;
                finishActivity();
            }
        }

        function finishActivity() {
            msgBar.innerText = "Great job! You analyzed the sentence!";
            msgBar.style.backgroundColor = "#b9f6ca";
            document.getElementById('rules-area').style.opacity = "1";
            logData('Activity Status', 'Complete', 'Yes');
            document.getElementById('next-activity-btn').style.display = 'block';
        }

        function goToNext() {
            logData('Navigation', 'Go to Sentence Building', 'N/A');
            window.location.href = 'sentence_building.html';
        }
    </script>
